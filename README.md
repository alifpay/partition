# partition

Автоматическое партиционирование таблиц в TimescaleDB.

Этот проект показывает, как упростить работу с большими объёмами данных с помощью партиционирования: таблицы автоматически разбиваются на части (партиции) по времени, что делает запросы быстрее и упрощает обслуживание базы данных.

## Зачем нужно партиционирование

Когда объём данных становится большим, одна «плоская» таблица приводит к:

- медленным запросам SELECT/UPDATE/DELETE;
- дорогим операциям VACUUM/ANALYZE;
- сложностям с архивированием и удалением старых данных.

Партиционирование (особенно с TimescaleDB) решает эти проблемы, разделяя данные по интервалам времени.

Типичные сценарии использования:

1. **Логи (logging)** – логи приложений, аудиторские события.
2. **Мониторинг (monitoring)** – метрики сервисов, системные метрики, time-series данные.
3. **Транзакции (transactions)** – платежи, операции аккаунтов, события в финансовых системах.

## Как это работает

- Используется TimescaleDB поверх PostgreSQL.
- Таблица превращается в hypertable и автоматически делится на партиции по времени.
- Старые партиции можно легко архивировать или удалять без влияния на свежие данные.

## Файлы в репозитории

- `partition.sql` – базовый пример партиционирования с TimescaleDB.
- `txn.sql` / `txn.md` – партиционирование таблицы транзакций (платёжные заказы) с примерами запросов.
- `services.sql` / `services.md` – партиционирование таблицы платёжных сервисов с JSONB и segmentby.
- `view.sql` / `view.md` – материализованные представления и continuous aggregates.
- `tips.md` – советы по высокопроизводительной вставке данных через COPY FROM.
- `bench.md` – результаты бенчмарков: сравнение производительности партиционированных и обычных таблиц.
- `api.md` – руководство по работе с API для платёжных операций, примеры запросов и ответов.
- `main.go` – Go-программа для генерации тестовых данных и демонстрации transactions.
- `README.md` – это описание.

## Требования

- PostgreSQL (поддерживаемая версия TimescaleDB).
- Расширение TimescaleDB, установленное и включённое в вашей базе.

## Быстрый старт

Можете развернуть TimescaleDB локально (dev) с помощью Docker:

```bash
docker run --name timescale-test \
  -e POSTGRES_PASSWORD=pass123 \
  -p 5432:5432 \
  -d timescale/timescaledb:latest-pg18
```

Подключитесь к базе:

```bash
psql -h localhost -U postgres -d postgres
```

Проверит расширение:

```sql
\dx;
```

Теперь можете выполнять SQL-скрипты из репозитория и экспериментировать с партиционированием.

## TODO

- [ ] Добавить примеры CREATE MATERIALIZED VIEW с continuous aggregates
- [ ] Больше примеров и объяснений про columnstore сжатие
